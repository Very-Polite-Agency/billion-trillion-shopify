{%- if card_item and card_item != blank -%}

  {% comment %}
      Renders a product card

      Accepts:
      - card_collection: {Object} Collection Liquid object
      - media_aspect_ratio: {String} Size of the product image card. Values are "square" and "portrait". Default is "square" (optional)
      - columns: {Number}
      - extend_height: {Boolean} Card height extends to available container space. Default: false (optional)

      Usage:
      {% render 'card-collection' %}
  {% endcomment %}

  {%- liquid

    assign snippet_name = 'card-product'
    assign snippet_classes = snippet_name
    assign snippet_id = snippet_name | append: '--' | append: card_item.id
    assign snippet_aria_role = card_aria_role | default: ''

    assign aos_id = snippet_id
    assign aos_delay = 250
    assign aos_delay_increment = 250

    assign available = card_item.available | default: false
    assign background = card_background | default: 'lemon'
    assign description = card_item.description | default: ''
    assign featured_image = card_item.featured_image | default: false
    assign price = card_item.price
    assign compare_at_price = card_item.compare_at_price
    assign title = card_item.title | default: ''
    assign url = card_item.url | default: ''

    unless available
      assign background = 'grey'
      assign snippet_classes = snippet_classes | append: ' unavailable'
    endunless

  -%}

  {%- style -%}
    #{{ snippet_id }} .{{ snippet_name }}__content {
      background: var(--theme-colour--{{ background }});
    }
  {%- endstyle -%}

  <article class="{{ snippet_classes }}" id="{{ snippet_id }}" {% if snippet_aria_role != blank %}role="{{ snippet_aria_role }}"{% endif %}>

    {% unless card_item.available %}
      <div class="{{ section_name }}__badge">{% render 'svg', type: 'badge.sold-out' %}</div>
    {% endunless %}

    {% if featured_image %}
      {%- liquid
        capture aos_attrs
          render 'aos-attributes', anchor: aos_id, delay: aos_delay, transition: 'fade-left'
        endcapture
        assign aos_delay = aos_delay | plus: aos_delay_increment
      -%}
      <div class="{{ snippet_name }}__image" {{ aos_attrs }}>
        {% if url != blank %}<a class="{{ snippet_name }}__image-link link" href="{{ url }}" target="_self" title="{{ title }}">{% endif %}
          {% render 'lazyload-image', alt_text: title, image: featured_image %}
        {% if url != blank %}</a>{% endif %}
      </div>
    {% endif %}

    {% if title != blank or description != blank %}
      <div class="{{ snippet_name }}__content">
        {% if title != blank %}
          {%- liquid
            capture aos_attrs
              render 'aos-attributes', anchor: aos_id, delay: aos_delay, transition: 'fade-right'
            endcapture
            assign aos_delay = aos_delay | plus: aos_delay_increment
          -%}
          <strong class="{{ snippet_name }}__heading heading--primary" {{ aos_attrs }}>Shop {{ title }}</strong>
        {% endif %}
        {% if description != blank %}
          {%- liquid
            capture aos_attrs
              render 'aos-attributes', anchor: aos_id, delay: aos_delay, transition: 'fade-right'
            endcapture
            assign aos_delay = aos_delay | plus: aos_delay_increment
          -%}
          <div class="{{ snippet_name }}__message body-copy--primary" {{ aos_attrs }}>{{ description }}</div>
        {% endif %}

        {% if url != blank %}
          {%- liquid
            capture aos_attrs
              render 'aos-attributes', anchor: aos_id, delay: aos_delay, transition: 'fade-right'
            endcapture
            assign aos_delay = aos_delay | plus: aos_delay_increment
          -%}

          {% capture snippet_classes %}{{ snippet_name }}__price price{% endcapture %}
          {%- liquid
            capture aos_attrs
              render 'aos-attributes', anchor: aos_id, delay: aos_delay, transition: 'fade-left'
            endcapture
            assign aos_delay = aos_delay | plus: aos_delay_increment
          -%}
          {% render 'price', aos_attrs: aos_attrs, classes: snippet_classes, product: card_item %}

          {%- liquid
            capture aos_attrs
              render 'aos-attributes', anchor: aos_id, delay: aos_delay, transition: 'fade-left'
            endcapture
          -%}
          <div class="{{ snippet_name }}__cta" {{ aos_attrs }}>
            <a class="{{ snippet_name }}__cta-link link{% unless available %}-disabled{% endunless %}" href="{{ url }}" target="_self" title="Shop {{ title }}">
              <div class="button--svg d-lg-none">{% render 'svg', type: 'button.shop-now.sm' %}</div>
              <div class="button--svg d-none d-lg-block">{% render 'svg', type: 'button.shop-now' %}</div>
            </a>
          </div>
        {% endif %}
      </div>
    {% endif %}

  </article>

{% endif %}
